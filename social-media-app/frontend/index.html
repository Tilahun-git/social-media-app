<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Mini Social App</title>
   <style>
  body {
    font-family: Arial, sans-serif;
    background: #f0f0f0;
    padding: 20px;
  }

  h1 {
    text-align: center;
    color: #2c3e50;
    font-size: 2rem;
  }

  .container {
    max-width: 700px;
    margin: auto;
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  }

  input,
  textarea {
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    border-radius: 5px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }

  button {
    background: #2ecc71;
    border: none;
    padding: 10px 15px;
    color: white;
    cursor: pointer;
    border-radius: 5px;
  }

  button:hover {
    background: #27ae60;
  }

  .post {
    border: 1px solid #ddd;
    background: #fafafa;
    margin-top: 20px;
    padding: 15px;
    border-radius: 8px;
  }

  .post img {
    max-width: 100%;
    margin-top: 10px;
    border-radius: 8px;
  }

  .comments {
    margin-top: 10px;
    padding-left: 15px;
    border-left: 2px solid #ccc;
    font-size: 0.9em;
  }

  .comment {
    margin: 5px 0;
  }

  .comment-input {
    display: flex;
    gap: 10px;
    margin-top: 10px;
  }

  .comment-input input {
    flex: 1;
  }

  /* üì± Mobile Devices */
  @media (max-width: 480px) {
    body {
      padding: 10px;
    }

    h1 {
      font-size: 1.5rem;
    }

    .container {
      padding: 15px;
    }

    button {
      width: 100%;
      margin-top: 5px;
    }

    .comment-input {
      flex-direction: column;
    }

    .comment-input button {
      width: 100%;
    }
  }

  /* üì±üì≤ Small Tablets */
  @media (min-width: 481px) and (max-width: 768px) {
    .container {
      padding: 18px;
    }

    h1 {
      font-size: 1.8rem;
    }

    button {
      padding: 10px 12px;
    }
  }

  /* üíª Larger Screens (no changes needed, but reserved for future adjustments) */
  @media (min-width: 1024px) {
    .container {
      padding: 25px;
    }
  }
</style>

  </head>
  <body>
    <h1>Mini Social App</h1>
    <div class="container">
      <div id="auth-section">
        <input id="username" placeholder="Username" />
        <input id="password" type="password" placeholder="Password" />
        <button onclick="register()">Register</button>
        <button onclick="login()">Login</button>
      </div>

      <hr />

      <div id="post-section" style="display: none">
        <textarea
          id="postContent"
          placeholder="What's on your mind?"
        ></textarea>
        <input type="file" id="postImage" />
        <button onclick="addPost()">Post</button>
        <button onclick="logout()" style="background: #e74c3c">Logout</button>
      </div>

      <div id="posts"></div>
    </div>

    <script>
      const API = "https://social-media-app-5-j2kt.onrender.com/api";

      async function register() {
        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value.trim();
        if (!username || !password)
          return alert("Username and password required");

        const res = await fetch(`${API}/auth/register`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password }),
        });

        const data = await res.json();
        if (data.error) return alert("Error: " + data.error);
        alert("Registered: " + data.username);
      }

      async function login() {
        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value.trim();
        if (!username || !password)
          return alert("Username and password required");

        const res = await fetch(`${API}/auth/login`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password }),
        });

        const data = await res.json();
        if (data.error) return alert("Login failed: " + data.error);
        localStorage.setItem("user", JSON.stringify(data));
        alert("Welcome, " + data.username);
        showPostSection(true);
        loadPosts();
      }

      function logout() {
        localStorage.removeItem("user");
        alert("Logged out");
        showPostSection(false);
        document.getElementById("posts").innerHTML = "";
      }

      function showPostSection(show) {
        document.getElementById("post-section").style.display = show
          ? "block"
          : "none";
        document.getElementById("auth-section").style.display = show
          ? "none"
          : "block";
      }

      async function addPost() {
        const user = JSON.parse(localStorage.getItem("user"));
        if (!user) return alert("Please log in");

        const content = document.getElementById("postContent").value.trim();
        const imageFile = document.getElementById("postImage").files[0];
        if (!content && !imageFile) return alert("Content or image required");

        const formData = new FormData();
        formData.append("author", user._id);
        formData.append("content", content);
        if (imageFile) formData.append("image", imageFile);

        const res = await fetch(`${API}/posts`, {
          method: "POST",
          body: formData,
        });

        const data = await res.json();
        if (data.error) return alert("Post error: " + data.error);

        document.getElementById("postContent").value = "";
        document.getElementById("postImage").value = null;
        loadPosts();
      }

      async function loadPosts() {
        const user = JSON.parse(localStorage.getItem("user"));
        const res = await fetch(`${API}/posts`);
        const posts = await res.json();

        const container = document.getElementById("posts");
        container.innerHTML = "";

        posts.forEach((p) => {
          const liked = p.likes.includes(user?._id);
          const div = document.createElement("div");
          div.className = "post";
          div.innerHTML = `
          <strong>${p.author.username}</strong>: ${p.content}
          ${
            p.image
              ? `<br><img src="https://social-media-app-5-j2kt.onrender.com/uploads/${p.image}">`
              : ""
          }
          <div>
            <button onclick="toggleLike('${p._id}')">${
            liked ? "‚ù§Ô∏è Unlike" : "ü§ç Like"
          } (${p.likes.length})</button>
            ${
              user && user._id === p.author._id
                ? `<button onclick="deletePost('${p._id}')" style="background:#e74c3c;margin-left:10px">üóëÔ∏è Delete</button>`
                : ""
            }
          </div>
          <div class="comments" id="comments-${p._id}"></div>
          <div class="comment-input">
            <input type="text" id="comment-input-${
              p._id
            }" placeholder="Write a comment..." />
            <button onclick="addComment('${p._id}')">Comment</button>
          </div>
        `;
          container.appendChild(div);
          loadComments(p._id);
        });
      }

      async function toggleLike(postId) {
        const user = JSON.parse(localStorage.getItem("user"));
        if (!user) return alert("Log in to like");

        const res = await fetch(`${API}/posts/${postId}/like`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ userId: user._id }),
        });

        const data = await res.json();
        if (data.error) return alert("Like error: " + data.error);
        loadPosts();
      }

      async function deletePost(postId) {
        if (!confirm("Delete this post?")) return;

        const res = await fetch(`${API}/posts/${postId}`, {
          method: "DELETE",
        });

        const data = await res.json();
        if (data.error) return alert("Delete error: " + data.error);
        loadPosts();
      }

      async function addComment(postId) {
        const user = JSON.parse(localStorage.getItem("user"));
        if (!user) return alert("Log in to comment");

        const input = document.getElementById(`comment-input-${postId}`);
        const content = input.value.trim();
        if (!content) return alert("Empty comment");

        const res = await fetch(`${API}/comments`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ author: user._id, post: postId, content }),
        });

        const data = await res.json();
        if (data.error) return alert("Comment error: " + data.error);

        input.value = "";
        loadComments(postId);
      }

      async function loadComments(postId) {
        const user = JSON.parse(localStorage.getItem("user"));
        const res = await fetch(`${API}/comments/post/${postId}`);
        const comments = await res.json();

        const container = document.getElementById(`comments-${postId}`);
        container.innerHTML = "";

        comments.forEach((c) => {
          const div = document.createElement("div");
          div.className = "comment";
          div.innerHTML = `
          ${c.author.username}: ${c.content}
          ${
            user && user._id === c.author._id
              ? `<button onclick="deleteComment('${c._id}', '${postId}')" style="margin-left:10px;color:red;background:none;border:none;cursor:pointer">üóëÔ∏è</button>`
              : ""
          }
        `;
          container.appendChild(div);
        });
      }

      async function deleteComment(commentId, postId) {
        if (!confirm("Delete comment?")) return;
        const res = await fetch(`${API}/comments/${commentId}`, {
          method: "DELETE",
        });
        const data = await res.json();
        if (data.error) return alert("Delete error: " + data.error);
        loadComments(postId);
      }

      if (localStorage.getItem("user")) {
        showPostSection(true);
        loadPosts();
      }
    </script>
  </body>
</html>
